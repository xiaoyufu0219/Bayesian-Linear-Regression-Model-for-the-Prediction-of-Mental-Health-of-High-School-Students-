# -*- coding: utf-8 -*-
"""littleemperordepression.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1iNsrpVFQx8tBt__HYzj2pxs6KAp04XWX
"""

import pandas as pd
import numpy as np
import pymc as pm
import arviz as az
import math

from google.colab import drive
drive.mount('/content/drive')

file_path = "/content/drive/MyDrive/bayesian/project/littleemperor.xlsx"

df = pd.read_excel(file_path, usecols=["T1depression", "T1anxiety","Height","Weight","FBG","TC","HDL-C","LDL-C","BMI","WHR","WtHR","Family location","Number of siblings","How much time do you spend with your father in elementary school?","How much time do you spend with your mother in elementary school?","Father’s education level","Mother’s education level","Family financial situation","Sleeping hours","Skipping breakfast"])


depression = df["T1depression"].to_numpy()
depression_miss = np.ma.masked_values(depression, value=22222)
anxiety = df["T1anxiety"].to_numpy()
anxiety_miss = np.ma.masked_values(anxiety, value=22222)
#height = df["Height"].to_numpy()
#height_miss = np.ma.masked_values(height, value=22222)
#weight= df["Weight"].to_numpy()
#weight_miss = np.ma.masked_values(weight, value=22222)
FBG= df["FBG"].to_numpy()
FBG_miss = np.ma.masked_values(FBG, value=22222)
TC= df["TC"].to_numpy()
TC_miss = np.ma.masked_values(TC, value=22222)
#HDL= df["HDL-C"].to_numpy()
#HDL_miss = np.ma.masked_values(HDL, value=22222)
#LDL= df["LDL-C"].to_numpy()
#LDL_miss = np.ma.masked_values(LDL, value=22222)
BMI= df["BMI"].to_numpy()
BMI_miss = np.ma.masked_values(BMI, value=22222)
#WHR= df["WHR"].to_numpy()
#WHR_miss = np.ma.masked_values(WHR, value=22222)
#WtHR= df["WtHR"].to_numpy()
#WtHR_miss = np.ma.masked_values(WtHR, value=22222)
#family_loc= df["Family location"].to_numpy()
#family_loc_miss = np.ma.masked_values(family_loc, value=22222)
sibling= df["Number of siblings"].to_numpy()
sibling_miss = np.ma.masked_values(sibling, value=22222)
father_time= df["How much time do you spend with your father in elementary school?"].to_numpy()
father_time_miss= np.ma.masked_values(father_time, value=22222)
mother_time= df["How much time do you spend with your mother in elementary school?"].to_numpy()
mother_time_miss= np.ma.masked_values(mother_time, value=22222)
father_edu= df["Father’s education level"].to_numpy()
father_edu_miss= np.ma.masked_values(father_edu, value=22222)
mother_edu= df["Mother’s education level"].to_numpy()
mother_edu_miss= np.ma.masked_values(mother_edu, value=22222)
financial= df["Family financial situation"].to_numpy()
financial_miss = np.ma.masked_values(financial, value=22222)
sleep_hour= df["Sleeping hours"].to_numpy()
sleep_hour_miss = np.ma.masked_values(sleep_hour, value=22222)
skipping_brkfst= df["Skipping breakfast"].to_numpy()
skipping_brkfst_miss = np.ma.masked_values(skipping_brkfst, value=22222)

with pm.Model() as model:
  depression_miss_data = pm.ConstantData('depression_miss',depression_miss)
  anxiety_miss_data = pm.ConstantData('anxiety_miss',anxiety_miss)
  #height_miss_data = pm.MutableData('height_miss',height_miss)
  #weight_miss_data = pm.MutableData('weight_miss',weight_miss)
  FBG_miss_data = pm.MutableData('FBG_miss',FBG_miss)
  TC_miss_data = pm.MutableData('TC_miss',TC_miss)
  #HDL_miss_data = pm.MutableData('HDL_miss',HDL_miss)
  #LDL_miss_data = pm.MutableData('LDL_miss',LDL_miss)
  BMI_miss_data = pm.MutableData('BMI_miss',BMI_miss)
  #WHR_miss_data = pm.MutableData('WHR_miss',WHR_miss)
  #WtHR_miss_data = pm.MutableData('WtHR_miss',WtHR_miss)
  #family_loc_miss_data = pm.MutableData('family_loc_miss',family_loc_miss)
  sibling_miss_data = pm.MutableData('sibling_miss',sibling_miss)
  father_time_miss_data = pm.MutableData('father_time_miss',father_time_miss)
  mother_time_miss_data = pm.MutableData('mother_time_miss',mother_time_miss)
  father_edu_miss_data = pm.MutableData('father_edu_miss',father_edu_miss)
  mother_edu_miss_data = pm.MutableData('mother_edu_miss',mother_edu_miss)
  financial_miss_data = pm.MutableData('financial_miss',financial_miss)
  sleep_hour_miss_data = pm.MutableData('sleep_hour_miss',sleep_hour_miss)
  skipping_brkfst_miss_data = pm.MutableData('skipping_brkfst_miss',skipping_brkfst_miss)

  g0 = pm.Normal('g0', mu=0, sigma = 10000)
  #g1 = pm.Normal('g1', mu=0, sigma = 0.001)
  #g2 = pm.Normal('g2', mu=0, sigma = 0.001)
  #g3 = pm.Normal('g3', mu=0, sigma = 0.001)
  #g4 = pm.Normal('g4', mu=0, sigma = 0.001)
  g5 = pm.Normal('g5', mu=0, sigma = 10000)
  g6 = pm.Normal('g6', mu=0, sigma = 10000)
  #g7 = pm.Normal('g7', mu=0, sigma = 0.001)
  #g8 = pm.Normal('g8', mu=0, sigma = 0.001)
  g9 = pm.Normal('g9', mu=0, sigma = 10000)
  #g10 = pm.Normal('g10', mu=0, sigma = 0.001)
  #g11 = pm.Normal('g11', mu=0, sigma = 0.001)
  #g12 = pm.Normal('g12', mu=0, sigma = 0.001)
  g13 = pm.Normal('g13', mu=0, sigma = 10000)
  g14 = pm.Normal('g14', mu=0, sigma = 10000)
  g15 = pm.Normal('g15', mu=0, sigma = 10000)
  g16 = pm.Normal('g16', mu=0, sigma = 10000)
  g17 = pm.Normal('g17', mu=0, sigma = 10000)
  g18 = pm.Normal('g18', mu=0, sigma = 10000)
  g19 = pm.Normal('g19', mu=0, sigma = 10000)
  g20 = pm.Normal('g20', mu=0, sigma = 10000)
  sigma_all = pm.HalfNormal('sigma', sigma=1)

  depression_miss_imputed = pm.Normal("depression_miss_imputed", mu=38.894, sigma=8.081, observed=depression_miss)
  anxiety_miss_imputed = pm.Normal("anxiety_miss_imputed", mu=32.829, sigma=6.282, observed=anxiety_miss)
  #height_miss_imputed = pm.Normal("height_miss_imputed", mu=20, sigma=5, observed=height_miss)
  #weight_miss_imputed = pm.Normal("weighweight_miss_imputedt_miss", mu=20, sigma=5, observed=weight_miss)
  FBG_miss_imputed = pm.Normal("FBG_miss_imputed", mu=4.6, sigma=0.44, observed=FBG_miss)
  TC_miss_imputed = pm.Normal("TC_miss_imputed", mu=4.2, sigma=0.74, observed=TC_miss)
  #HDL_miss_imputed = pm.Normal("HDL_miss_imputed", mu=20, sigma=5, observed=HDL_miss)
  #LDL_miss_imputed = pm.Normal("LDL_miss_imputed", mu=20, sigma=5, observed=LDL_miss)
  BMI_miss_imputed = pm.Normal("BMI_miss_imputed", mu=19, sigma=2.9, observed=BMI_miss)
  #WHR_miss_imputed = pm.Normal("WHR_miss_imputed", mu=20, sigma=5, observed=WHR_miss)
  #WtHR_miss_imputed = pm.Normal("WtHR_miss_imputed", mu=20, sigma=5, observed=WtHR_miss)
  #family_loc_miss_imputed = pm.Normal("family_loc_miss_imputed", mu=20, sigma=5, observed=family_loc_miss)
  sibling_miss_imputed = pm.Normal("sibling_miss_imputed", mu=1.436, sigma=0.132, observed=sibling_miss)
  father_time_miss_imputed = pm.Normal('father_time_miss_imputed', mu=5, sigma=0.8, observed=father_time_miss)
  mother_time_miss_imputed = pm.Normal('mother_time_miss_imputed', mu=5, sigma=0.8,observed=mother_time_miss)
  father_edu_miss_imputed = pm.Normal("father_edu_miss_imputed", mu=5.5, sigma=4.7, observed=father_edu_miss)
  mother_edu_miss_imputed = pm.Normal("mother_edu_miss_imputed", mu=4.5, sigma=4.6, observed=mother_edu_miss)
  financial_miss_imputed = pm.Normal("financial_miss_imputed", mu=3, sigma=0.5, observed=financial_miss)
  sleep_hour_miss_imputed = pm.Normal("sleep_hour_miss_imputed", mu=2.3, sigma=0.7, observed=sleep_hour_miss)
  skipping_brkfst_miss_imputed = pm.Normal("skipping_brkfst_miss_imputed", mu=1.3, sigma=0.8, observed=skipping_brkfst_miss)
  
  RANDOM_SEED = 58
  rng = np.random.default_rng(RANDOM_SEED)

  #mu = np.exp(g0 + g3*height_miss_imputed+g4*weight_miss_imputed+g5*FBG_miss_imputed+g6*TC_miss_imputed+g7*HDL_miss_imputed+g8*LDL_miss_imputed+g9*BMI_miss_imputed+g10*WHR_miss_imputed+g11*WtHR_miss_imputed+g12*family_loc_miss_imputed+g13*sibling_miss_imputed+g14*father_time_miss_imputed+g15*mother_time_miss_imputed+g16*father_edu_miss_imputed+g17*mother_edu_miss_imputed+g18*financial_miss_imputed+g19*sleep_hour_miss_imputed+g20*skipping_brkfst_miss_imputed)

  mu = g0 +g5*FBG_miss_imputed +g6*TC_miss_imputed+g9*BMI_miss_imputed+ g13*sibling_miss_imputed+g14*father_time_miss_imputed+g15*mother_time_miss_imputed+g16*father_edu_miss_imputed+g17*mother_edu_miss_imputed+g18*financial_miss_imputed+g19*sleep_hour_miss_imputed+g20*skipping_brkfst_miss_imputed

  obs = pm.Normal("depression_miss_likelihood", mu=mu, sigma=sigma_all, observed=depression_miss_data)
  
  trace = pm.sample(1500, tune=300, target_accept=.9)

  print(az.summary(trace,var_names=["g0","g5","g6","g9","g13","g14","g15","g16","g17","g18","g19","g20"], hdi_prob=0.95))
  #az.plot_trace(trace,combined=False)
  idata = pm.sample_prior_predictive(samples=50, random_seed=rng)

  idata.extend(pm.sample(1000, tune=20, random_seed=rng))
  

  pm.sample_posterior_predictive(idata, extend_inferencedata=True, random_seed=rng)

  
  idata.posterior_predictive
  az.plot_ppc(idata, num_pp_samples=100)